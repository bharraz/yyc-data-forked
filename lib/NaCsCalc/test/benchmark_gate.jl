#!/usr/bin/julia

using NaCsCalc
using BenchmarkTools

const Clf = NaCsCalc.Clifford

@inline function benchmark(state, gate::Clf.Clifford1Q)
    n = state.n
    @inbounds for i in 1:n
        Clf.apply!(state, gate, i)
    end
end

@inline function benchmark(state, gate::Clf.Clifford2Q)
    n = state.n
    @inbounds for i in 1:n
        for j in 1:n - 1
            j = j < i ? j : j + 1
            Clf.apply!(state, gate, i, j)
        end
    end
end

const state1_1 = Clf.StabilizerState(29)
const state1_2 = Clf.StabilizerState(271)
const state1_3 = Clf.StabilizerState(5000)
const state2_1 = Clf.InvStabilizerState(29)
const state2_2 = Clf.InvStabilizerState(271)
const state2_3 = Clf.InvStabilizerState(5000)

function benchmark_all(gate)
    if gate isa Clf.Clifford1Q && !isempty(get(ENV, "CLF_SKIP_1Q", ""))
        return
    elseif gate isa Clf.Clifford2Q && !isempty(get(ENV, "CLF_SKIP_2Q", ""))
        return
    end
    println(gate)
    @btime benchmark($(state1_1), $gate)
    @btime benchmark($(state1_2), $gate)
    @btime benchmark($(state1_3), $gate)
    @btime benchmark($(state2_1), $gate)
    @btime benchmark($(state2_2), $gate)
    @btime benchmark($(state2_3), $gate)
end

if isempty(get(ENV, "CLF_SKIP_INIT", ""))
    # 50.234 ns (0 allocations: 0 bytes)
    # 879.120 ns (0 allocations: 0 bytes)
    # 169.243 μs (0 allocations: 0 bytes)
    # 42.758 ns (0 allocations: 0 bytes)
    # 827.050 ns (0 allocations: 0 bytes)
    # 172.910 μs (0 allocations: 0 bytes)
    println("Init X")
    @btime Clf.init_state_x!($(state1_1))
    @btime Clf.init_state_x!($(state1_2))
    @btime Clf.init_state_x!($(state1_3))
    @btime Clf.init_state_x!($(state2_1))
    @btime Clf.init_state_x!($(state2_2))
    @btime Clf.init_state_x!($(state2_3))

    # 50.234 ns (0 allocations: 0 bytes)
    # 878.300 ns (0 allocations: 0 bytes)
    # 170.618 μs (0 allocations: 0 bytes)
    # 42.800 ns (0 allocations: 0 bytes)
    # 850.203 ns (0 allocations: 0 bytes)
    # 166.619 μs (0 allocations: 0 bytes)
    println("Init Z")
    @btime Clf.init_state_z!($(state1_1))
    @btime Clf.init_state_z!($(state1_2))
    @btime Clf.init_state_z!($(state1_3))
    @btime Clf.init_state_z!($(state2_1))
    @btime Clf.init_state_z!($(state2_2))
    @btime Clf.init_state_z!($(state2_3))
end

# 2.291 ns (0 allocations: 0 bytes)
# 2.250 ns (0 allocations: 0 bytes)
# 2.250 ns (0 allocations: 0 bytes)
# 2.291 ns (0 allocations: 0 bytes)
# 2.625 ns (0 allocations: 0 bytes)
# 2.250 ns (0 allocations: 0 bytes)
benchmark_all(Clf.IGate())

# 63.476 ns (0 allocations: 0 bytes)
# 2.426 μs (0 allocations: 0 bytes)
# 441.567 μs (0 allocations: 0 bytes)
# 38.349 ns (0 allocations: 0 bytes)
# 845.800 ns (0 allocations: 0 bytes)
# 266.073 μs (0 allocations: 0 bytes)
benchmark_all(Clf.HGate())

# 63.603 ns (0 allocations: 0 bytes)
# 1.483 μs (0 allocations: 0 bytes)
# 129.995 μs (0 allocations: 0 bytes)
# 7.291 ns (0 allocations: 0 bytes)
# 10.301 ns (0 allocations: 0 bytes)
# 101.137 ns (0 allocations: 0 bytes)
benchmark_all(Clf.XGate())

# 63.772 ns (0 allocations: 0 bytes)
# 1.429 μs (0 allocations: 0 bytes)
# 250.740 μs (0 allocations: 0 bytes)
# 8.382 ns (0 allocations: 0 bytes)
# 14.904 ns (0 allocations: 0 bytes)
# 182.187 ns (0 allocations: 0 bytes)
benchmark_all(Clf.YGate())

# 63.560 ns (0 allocations: 0 bytes)
# 1.475 μs (0 allocations: 0 bytes)
# 129.786 μs (0 allocations: 0 bytes)
# 7.632 ns (0 allocations: 0 bytes)
# 10.301 ns (0 allocations: 0 bytes)
# 70.979 ns (0 allocations: 0 bytes)
benchmark_all(Clf.ZGate())

# 63.305 ns (0 allocations: 0 bytes)
# 2.333 μs (0 allocations: 0 bytes)
# 292.239 μs (0 allocations: 0 bytes)
# 52.483 ns (0 allocations: 0 bytes)
# 999.900 ns (0 allocations: 0 bytes)
# 256.033 μs (0 allocations: 0 bytes)
benchmark_all(Clf.SGate())

# 63.262 ns (0 allocations: 0 bytes)
# 2.338 μs (0 allocations: 0 bytes)
# 289.573 μs (0 allocations: 0 bytes)
# 53.805 ns (0 allocations: 0 bytes)
# 1.008 μs (0 allocations: 0 bytes)
# 256.365 μs (0 allocations: 0 bytes)
benchmark_all(Clf.ISGate())

# 63.264 ns (0 allocations: 0 bytes)
# 2.324 μs (0 allocations: 0 bytes)
# 298.412 μs (0 allocations: 0 bytes)
# 52.484 ns (0 allocations: 0 bytes)
# 979.143 ns (0 allocations: 0 bytes)
# 270.537 μs (0 allocations: 0 bytes)
benchmark_all(Clf.SXGate())

# 63.263 ns (0 allocations: 0 bytes)
# 2.338 μs (0 allocations: 0 bytes)
# 299.370 μs (0 allocations: 0 bytes)
# 53.806 ns (0 allocations: 0 bytes)
# 1.008 μs (0 allocations: 0 bytes)
# 260.079 μs (0 allocations: 0 bytes)
benchmark_all(Clf.ISXGate())

# 63.477 ns (0 allocations: 0 bytes)
# 2.440 μs (0 allocations: 0 bytes)
# 442.993 μs (0 allocations: 0 bytes)
# 38.683 ns (0 allocations: 0 bytes)
# 845.229 ns (0 allocations: 0 bytes)
# 269.412 μs (0 allocations: 0 bytes)
benchmark_all(Clf.SYGate())

# 63.434 ns (0 allocations: 0 bytes)
# 2.431 μs (0 allocations: 0 bytes)
# 437.617 μs (0 allocations: 0 bytes)
# 38.557 ns (0 allocations: 0 bytes)
# 845.229 ns (0 allocations: 0 bytes)
# 269.287 μs (0 allocations: 0 bytes)
benchmark_all(Clf.ISYGate())

# 1.837 μs (0 allocations: 0 bytes)
# 653.648 μs (0 allocations: 0 bytes)
# 2.304 s (0 allocations: 0 bytes)
# 3.010 μs (0 allocations: 0 bytes)
# 498.059 μs (0 allocations: 0 bytes)
# 2.184 s (0 allocations: 0 bytes)
benchmark_all(Clf.CNOTGate())

# 1.838 μs (0 allocations: 0 bytes)
# 651.731 μs (0 allocations: 0 bytes)
# 2.371 s (0 allocations: 0 bytes)
# 3.005 μs (0 allocations: 0 bytes)
# 498.059 μs (0 allocations: 0 bytes)
# 2.175 s (0 allocations: 0 bytes)
benchmark_all(Clf.XCXGate())
# 2.097 μs (0 allocations: 0 bytes)
# 631.480 μs (0 allocations: 0 bytes)
# 3.116 s (0 allocations: 0 bytes)
# 4.804 μs (0 allocations: 0 bytes)
# 942.783 μs (0 allocations: 0 bytes)
# 3.912 s (0 allocations: 0 bytes)
benchmark_all(Clf.XCYGate())
# 1.817 μs (0 allocations: 0 bytes)
# 640.605 μs (0 allocations: 0 bytes)
# 2.491 s (0 allocations: 0 bytes)
# 3.031 μs (0 allocations: 0 bytes)
# 497.892 μs (0 allocations: 0 bytes)
# 2.224 s (0 allocations: 0 bytes)
benchmark_all(Clf.CNOT21Gate())
# 1.808 μs (0 allocations: 0 bytes)
# 644.980 μs (0 allocations: 0 bytes)
# 2.633 s (0 allocations: 0 bytes)
# 3.010 μs (0 allocations: 0 bytes)
# 500.934 μs (0 allocations: 0 bytes)
# 2.264 s (0 allocations: 0 bytes)
benchmark_all(Clf.aCNOT21Gate())

# 1.925 μs (0 allocations: 0 bytes)
# 635.688 μs (0 allocations: 0 bytes)
# 3.285 s (0 allocations: 0 bytes)
# 6.284 μs (0 allocations: 0 bytes)
# 914.656 μs (0 allocations: 0 bytes)
# 3.932 s (0 allocations: 0 bytes)
benchmark_all(Clf.YCXGate())
# 2.125 μs (0 allocations: 0 bytes)
# 653.943 μs (0 allocations: 0 bytes)
# 4.161 s (0 allocations: 0 bytes)
# 8.180 μs (0 allocations: 0 bytes)
# 1.376 ms (0 allocations: 0 bytes)
# 6.113 s (0 allocations: 0 bytes)
benchmark_all(Clf.YCYGate())
# 1.896 μs (0 allocations: 0 bytes)
# 631.157 μs (0 allocations: 0 bytes)
# 3.453 s (0 allocations: 0 bytes)
# 4.655 μs (0 allocations: 0 bytes)
# 926.696 μs (0 allocations: 0 bytes)
# 4.084 s (0 allocations: 0 bytes)
benchmark_all(Clf.YCZGate())

# 1.779 μs (0 allocations: 0 bytes)
# 651.119 μs (0 allocations: 0 bytes)
# 2.809 s (0 allocations: 0 bytes)
# 3.010 μs (0 allocations: 0 bytes)
# 500.955 μs (0 allocations: 0 bytes)
# 2.301 s (0 allocations: 0 bytes)
benchmark_all(Clf.aCNOTGate())
# 1.879 μs (0 allocations: 0 bytes)
# 626.913 μs (0 allocations: 0 bytes)
# 3.428 s (0 allocations: 0 bytes)
# 4.167 μs (0 allocations: 0 bytes)
# 839.498 μs (0 allocations: 0 bytes)
# 4.133 s (0 allocations: 0 bytes)
benchmark_all(Clf.CYGate())
# 1.812 μs (0 allocations: 0 bytes)
# 645.457 μs (0 allocations: 0 bytes)
# 2.846 s (0 allocations: 0 bytes)
# 3.010 μs (0 allocations: 0 bytes)
# 497.875 μs (0 allocations: 0 bytes)
# 2.324 s (0 allocations: 0 bytes)
benchmark_all(Clf.CZGate())

# 1.808 μs (0 allocations: 0 bytes)
# 658.585 μs (0 allocations: 0 bytes)
# 3.954 s (0 allocations: 0 bytes)
# 3.120 μs (0 allocations: 0 bytes)
# 535.919 μs (0 allocations: 0 bytes)
# 2.782 s (0 allocations: 0 bytes)
benchmark_all(Clf.CXSWAPGate())
# 1.821 μs (0 allocations: 0 bytes)
# 637.378 μs (0 allocations: 0 bytes)
# 3.962 s (0 allocations: 0 bytes)
# 3.130 μs (0 allocations: 0 bytes)
# 536.379 μs (0 allocations: 0 bytes)
# 2.826 s (0 allocations: 0 bytes)
benchmark_all(Clf.SWAPCXGate())

# 1.108 μs (0 allocations: 0 bytes)
# 492.296 μs (0 allocations: 0 bytes)
# 3.287 s (0 allocations: 0 bytes)
# 2.241 μs (0 allocations: 0 bytes)
# 483.255 μs (0 allocations: 0 bytes)
# 2.379 s (0 allocations: 0 bytes)
benchmark_all(Clf.SWAPGate())
# 1.767 μs (0 allocations: 0 bytes)
# 636.340 μs (0 allocations: 0 bytes)
# 4.211 s (0 allocations: 0 bytes)
# 5.424 μs (0 allocations: 0 bytes)
# 1.101 ms (0 allocations: 0 bytes)
# 5.713 s (0 allocations: 0 bytes)
benchmark_all(Clf.iSWAPGate())
# 2.051 μs (0 allocations: 0 bytes)
# 636.633 μs (0 allocations: 0 bytes)
# 4.136 s (0 allocations: 0 bytes)
# 5.653 μs (0 allocations: 0 bytes)
# 1.122 ms (0 allocations: 0 bytes)
# 5.745 s (0 allocations: 0 bytes)
benchmark_all(Clf.IiSWAPGate())

# 2.056 μs (0 allocations: 0 bytes)
# 661.052 μs (0 allocations: 0 bytes)
# 3.180 s (0 allocations: 0 bytes)
# 6.333 μs (0 allocations: 0 bytes)
# 923.598 μs (0 allocations: 0 bytes)
# 4.967 s (0 allocations: 0 bytes)
benchmark_all(Clf.XXGate())
# 1.804 μs (0 allocations: 0 bytes)
# 654.845 μs (0 allocations: 0 bytes)
# 3.390 s (0 allocations: 0 bytes)
# 6.342 μs (0 allocations: 0 bytes)
# 926.475 μs (0 allocations: 0 bytes)
# 4.358 s (0 allocations: 0 bytes)
benchmark_all(Clf.IXXGate())
# 2.250 μs (0 allocations: 0 bytes)
# 643.804 μs (0 allocations: 0 bytes)
# 3.646 s (0 allocations: 0 bytes)
# 6.017 μs (0 allocations: 0 bytes)
# 1.127 ms (0 allocations: 0 bytes)
# 5.406 s (0 allocations: 0 bytes)
benchmark_all(Clf.XYGate())
# 2.255 μs (0 allocations: 0 bytes)
# 645.554 μs (0 allocations: 0 bytes)
# 3.645 s (0 allocations: 0 bytes)
# 6.017 μs (0 allocations: 0 bytes)
# 1.124 ms (0 allocations: 0 bytes)
# 5.656 s (0 allocations: 0 bytes)
benchmark_all(Clf.IXYGate())
# 1.846 μs (0 allocations: 0 bytes)
# 649.930 μs (0 allocations: 0 bytes)
# 3.218 s (0 allocations: 0 bytes)
# 4.619 μs (0 allocations: 0 bytes)
# 924.978 μs (0 allocations: 0 bytes)
# 4.978 s (0 allocations: 0 bytes)
benchmark_all(Clf.XZGate())
# 1.842 μs (0 allocations: 0 bytes)
# 650.472 μs (0 allocations: 0 bytes)
# 3.232 s (0 allocations: 0 bytes)
# 4.685 μs (0 allocations: 0 bytes)
# 933.853 μs (0 allocations: 0 bytes)
# 4.820 s (0 allocations: 0 bytes)
benchmark_all(Clf.IXZGate())

# 2.093 μs (0 allocations: 0 bytes)
# 600.305 μs (0 allocations: 0 bytes)
# 3.767 s (0 allocations: 0 bytes)
# 5.431 μs (0 allocations: 0 bytes)
# 1.089 ms (0 allocations: 0 bytes)
# 5.509 s (0 allocations: 0 bytes)
benchmark_all(Clf.YXGate())
# 2.088 μs (0 allocations: 0 bytes)
# 596.888 μs (0 allocations: 0 bytes)
# 3.805 s (0 allocations: 0 bytes)
# 5.452 μs (0 allocations: 0 bytes)
# 1.093 ms (0 allocations: 0 bytes)
# 5.628 s (0 allocations: 0 bytes)
benchmark_all(Clf.IYXGate())
# 2.194 μs (0 allocations: 0 bytes)
# 633.723 μs (0 allocations: 0 bytes)
# 4.546 s (0 allocations: 0 bytes)
# 8.764 μs (0 allocations: 0 bytes)
# 1.440 ms (0 allocations: 0 bytes)
# 7.315 s (0 allocations: 0 bytes)
benchmark_all(Clf.YYGate())
# 2.194 μs (0 allocations: 0 bytes)
# 634.307 μs (0 allocations: 0 bytes)
# 4.354 s (0 allocations: 0 bytes)
# 8.764 μs (0 allocations: 0 bytes)
# 1.438 ms (0 allocations: 0 bytes)
# 7.035 s (0 allocations: 0 bytes)
benchmark_all(Clf.IYYGate())
# 2.097 μs (0 allocations: 0 bytes)
# 597.432 μs (0 allocations: 0 bytes)
# 3.714 s (0 allocations: 0 bytes)
# 5.569 μs (0 allocations: 0 bytes)
# 1.092 ms (0 allocations: 0 bytes)
# 5.498 s (0 allocations: 0 bytes)
benchmark_all(Clf.YZGate())
# 2.097 μs (0 allocations: 0 bytes)
# 597.681 μs (0 allocations: 0 bytes)
# 3.717 s (0 allocations: 0 bytes)
# 5.569 μs (0 allocations: 0 bytes)
# 1.092 ms (0 allocations: 0 bytes)
# 5.396 s (0 allocations: 0 bytes)
benchmark_all(Clf.IYZGate())

# 1.854 μs (0 allocations: 0 bytes)
# 653.891 μs (0 allocations: 0 bytes)
# 3.177 s (0 allocations: 0 bytes)
# 3.281 μs (0 allocations: 0 bytes)
# 767.602 μs (0 allocations: 0 bytes)
# 4.533 s (0 allocations: 0 bytes)
benchmark_all(Clf.ZXGate())
# 1.858 μs (0 allocations: 0 bytes)
# 654.142 μs (0 allocations: 0 bytes)
# 3.150 s (0 allocations: 0 bytes)
# 3.391 μs (0 allocations: 0 bytes)
# 784.061 μs (0 allocations: 0 bytes)
# 4.481 s (0 allocations: 0 bytes)
benchmark_all(Clf.IZXGate())
# 2.134 μs (0 allocations: 0 bytes)
# 633.391 μs (0 allocations: 0 bytes)
# 3.773 s (0 allocations: 0 bytes)
# 6.325 μs (0 allocations: 0 bytes)
# 1.171 ms (0 allocations: 0 bytes)
# 5.565 s (0 allocations: 0 bytes)
benchmark_all(Clf.ZYGate())
# 2.134 μs (0 allocations: 0 bytes)
# 634.683 μs (0 allocations: 0 bytes)
# 3.756 s (0 allocations: 0 bytes)
# 6.217 μs (0 allocations: 0 bytes)
# 1.183 ms (0 allocations: 0 bytes)
# 5.728 s (0 allocations: 0 bytes)
benchmark_all(Clf.IZYGate())
# 1.804 μs (0 allocations: 0 bytes)
# 653.892 μs (0 allocations: 0 bytes)
# 3.158 s (0 allocations: 0 bytes)
# 5.992 μs (0 allocations: 0 bytes)
# 919.797 μs (0 allocations: 0 bytes)
# 4.647 s (0 allocations: 0 bytes)
benchmark_all(Clf.ZZGate())
# 2.060 μs (0 allocations: 0 bytes)
# 659.727 μs (0 allocations: 0 bytes)
# 3.184 s (0 allocations: 0 bytes)
# 5.992 μs (0 allocations: 0 bytes)
# 921.206 μs (0 allocations: 0 bytes)
# 4.642 s (0 allocations: 0 bytes)
benchmark_all(Clf.IZZGate())
